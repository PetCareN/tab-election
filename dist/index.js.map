{"version":3,"file":"index.js","sources":["../src/utils.js","../src/leader-elector.js","../src/metadata.js","../src/index.js"],"sourcesContent":["\nconst chars = (\n  '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'\n).split('');\n\nexport function createNodeId() {\n  let id = '';\n  let length = 6;\n  while (length--) {\n    id += chars[Math.random() * chars.length | 0];\n  }\n  return id;\n}\n","import { createNodeId } from './utils';\n\nconst VOTE_PERIOD = 500;\nconst HEARTBEAT = 500;\nconst ELECTION_MIN = 2000; // when not visible in browsers heartbeat is slowed down to 1000 ms, keep above this\nconst ELECTION_MAX = 3000;\n\nconst STATE_FOLLOWER = 'follower';\nconst STATE_CANDIDATE = 'candidate';\nconst STATE_LEADER = 'leader';\nconst STATE_CLOSED = 'closed';\n\n\n/**\n * Create an elector, listen in the callback provided in waitForLeadership() to know when this becomes the leader. Call\n * close() to disconnect. Ignore the other methods, they are not for you. This started off using raft but because of\n * the environment was simplified. setTimeout/setInterval are throttled to 1000ms in most browsers when the tab is not\n * the focus. Also they all share localStorage which is needed to trigger updates anyway, so we use that instead of\n * proper voting. It works great! Just don't lower the numbers above without testing because the throttling will\n * make multiple leaders become elected with lower numbers, even when voting was in place.\n */\nexport default class LeaderElector {\n\n  constructor(name) {\n    this.name = name;\n    this.state = STATE_CLOSED;\n    this.nodeId = createNodeId();\n    this.timeout = 0;\n    this.callback = null;\n    this.close = this.close.bind(this);\n  }\n\n  /**\n   * Wait until this tab becomes the leader, then do something about it. Once the leader, it will remain the leader\n   * until closed. The first tab open will almost immediately become the leader (within 100 ms).\n   * @return {LeaderElector} A reference to itself.\n   */\n  waitForLeadership(callback) {\n    this.callback = callback;\n    this.becomeFollower();\n    return this;\n  }\n\n  /**\n   * Close this leader elector. To restart it, you must call waitForLeadership again.\n   */\n  close() {\n    clearTimeout(this.timeout);\n    window.removeEventListener('unload', this.close);\n    if (this.state === STATE_LEADER) {\n      let leader = getLeaderInfo(this.name);\n      if (leader && leader.nodeId === this.nodeId) {\n        clearLeaderInfo(this.name);\n      }\n    }\n    this.state = STATE_CLOSED;\n  }\n\n\n  hasLeader() {\n    let leader = getLeaderInfo(this.name);\n    return leader && Date.now() - leader.timestamp < ELECTION_MIN;\n  }\n\n  becomeFollower() {\n    this.state = STATE_FOLLOWER;\n    clearTimeout(this.timeout);\n\n    let checkLeadership = () => {\n      // If no leader or the leader is long gone, immediately take leadership\n      if (!this.hasLeader()) return this.becomeCandidate();\n      let interval = Math.round(ELECTION_MAX - ELECTION_MIN * Math.random()) + ELECTION_MIN;\n      this.timeout = setTimeout(checkLeadership, interval);\n    };\n\n    checkLeadership();\n  }\n\n  becomeCandidate() {\n    this.state = STATE_CANDIDATE;\n    clearTimeout(this.timeout);\n\n    setLeaderInfo(this.name, this.nodeId);\n    this.timeout = setTimeout(() => {\n      // last one wins\n      let leader = getLeaderInfo(this.name);\n      if (leader.nodeId === this.nodeId) {\n        this.becomeLeader();\n      } else {\n        this.becomeFollower();\n      }\n    }, VOTE_PERIOD);\n  }\n\n  becomeLeader() {\n    this.state = STATE_LEADER;\n    clearTimeout(this.timeout);\n\n    let heartbeat = () => {\n      setLeaderInfo(this.name, this.nodeId);\n      this.timeout = setTimeout(heartbeat, HEARTBEAT);\n    };\n    heartbeat();\n    window.addEventListener('unload', this.close);\n    this.callback();\n  }\n}\n\n\n\nfunction getLeaderInfo(name) {\n  try {\n    return JSON.parse(localStorage.getItem(`tab-leader:${name}`));\n  } catch(err) {\n    return null;\n  }\n}\n\nfunction setLeaderInfo(name, nodeId) {\n  localStorage.setItem(`tab-leader:${name}`, JSON.stringify({ nodeId, timestamp: Date.now() }));\n}\n\nfunction clearLeaderInfo(name) {\n  localStorage.removeItem(`tab-leader:${name}`);\n}\n","import { createNodeId } from './utils';\n\nconst METADATA_HEARTBEAT = 500;\nconst METADATA_MAX = 2000;\n\n/**\n * Create a metadata consumer to set metadata for this tab and get the metadata from other tabs. Call subscribe() to\n * start listening and close() to disconnect.\n */\nexport default class Metadata {\n\n  constructor(name) {\n    this.name = name;\n    this.nodeId = createNodeId();\n    this.timeout = 0;\n    this.callback = null;\n    this.close = this.close.bind(this);\n    this.version = 0;\n    this.source = {};\n    this.metadata = {};\n    this.data = {};\n    this.subscribers = [];\n\n    this.watchMetadata();\n    this.set(this.data);\n    window.addEventListener('unload', this.close);\n  }\n\n  /**\n   * Subscribe to changes in the node metadata.\n   * @param  {Function} callback A function that is called whenever node metadata is changed on any node.\n   * @return {Function} A function to cancel the subscription.\n   */\n  subscribe(callback) {\n    this.subscribers.push(callback);\n    return function cancel() {\n      const index = this.subscribers.indexOf(callback);\n      if (index >= 0) this.subscribers.splice(index, 1);\n    };\n  }\n\n  /**\n   * Sets the metadata for this node.\n   * @param  {Object} metadata The metadata for this node.\n   * @return {Metadata} A reference to itself.\n   */\n  set(data) {\n    this.data = Object.assign(this.data, data);\n    const metadata = getMetadata(this.name);\n    const thisNode = metadata[this.nodeId] || (metadata[this.nodeId] = {});\n    thisNode.timestamp = Date.now();\n    thisNode.version = this.version++;\n    thisNode.data = this.data;\n    setMetadata(this.name, metadata);\n\n    // Send updates locally immediately\n    this.source = metadata;\n    this.metadata[this.nodeId] = this.data;\n    this.subscribers.forEach(fn => fn.call(this, this.metadata, { [this.nodeId]: this.data }));\n\n    return this;\n  }\n\n  /**\n   * Close this leader elector. To restart it, you must call waitForLeadership again.\n   */\n  close() {\n    clearTimeout(this.timeout);\n    window.removeEventListener('unload', this.close);\n    const metadata = getMetadata(this.name);\n    delete metadata[this.nodeId];\n    setMetadata(this.name, metadata);\n  }\n\n\n  watchMetadata() {\n\n    const heartbeat = () => {\n      const metadata = getMetadata(this.name);\n      const now = Date.now();\n      const changed = {};\n\n      // Look for changes and clean up old nodes\n      Object.keys(metadata).forEach(nodeId => {\n        const entry = metadata[nodeId];\n        if (now - entry.timestamp > METADATA_MAX) {\n          changed[nodeId] = null;\n          delete metadata[nodeId];\n        } else {\n          if (!this.source[nodeId] || this.source[nodeId].version < entry.version) {\n            changed[nodeId] = entry.data;\n          }\n        }\n      });\n\n      // Update our timestamp\n      const thisNode = metadata[this.nodeId] || (metadata[this.nodeId] = {\n        timestamp: 0,\n        version: this.version,\n        data: {}\n      });\n      thisNode.timestamp = Date.now();\n      setMetadata(this.name, metadata);\n\n      // Dispatch update if there was one\n      if (Object.keys(changed).length) {\n        this.source = metadata;\n        this.metadata = {};\n        Object.keys(metadata).forEach(nodeId => this.metadata[nodeId] = metadata[nodeId].data);\n        this.subscribers.forEach(fn => fn.call(this, this.metadata, changed));\n      }\n\n      this.timeout = setTimeout(heartbeat, METADATA_HEARTBEAT);\n    };\n\n    heartbeat();\n  }\n}\n\n\nfunction getMetadata(name) {\n  return JSON.parse(localStorage.getItem(`tab-metadata:${name}`) || '{}');\n}\n\nfunction setMetadata(name, metadata) {\n  localStorage.setItem(`tab-metadata:${name}`, JSON.stringify(metadata));\n}\n","import LeaderElector from './leader-elector';\nimport Metadata from './metadata';\n\nexport { LeaderElector };\n\n// Shortcut, returns the elector that you can later close, and calls the callback once this tab becomes the leader.\nexport function waitForLeadership(name, callback) {\n  if (typeof name === 'function') {\n    callback = name;\n    name = 'default';\n  }\n  const elector = new LeaderElector(name);\n  return elector.waitForLeadership(callback);\n}\n\n// Shortcut, returns the TabMetadata that you can set metadata and later close, and calls the callback whenever tab\n// metadata changes.\nexport function getMetadata(name, callback) {\n  if (typeof name === 'function') {\n    callback = name;\n    name = 'default';\n  }\n  const metadata = new Metadata(name);\n  metadata.subscribe(callback);\n  return metadata;\n}\n"],"names":["const","let","this","getMetadata"],"mappings":"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"}